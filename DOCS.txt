### **Q1:** Объясни по шагам что происходит с точки зрения бухгалтерии, когда клиент купил товар (дебет, кредит, активный/пассивный счета), весь путь до уплаты налогов и выплаты зарплат.

**A1:**  
Процесс делится на несколько этапов:

1. **Продажа товара клиенту:**
   - Оплата (если предоплата):  
     *Дебет 51 (Расчётный счёт) — Кредит 62 (Расчёты с покупателями)*
   - Признание выручки:  
     *Дебет 62 — Кредит 90.1 (Выручка)*
   - Списание себестоимости:  
     *Дебет 90.2 (Себестоимость продаж) — Кредит 41 (Товары)*
   - Начисление НДС (на ОСНО):  
     *Дебет 90.3 (НДС) — Кредит 68 (Расчёты по налогам)*

2. **Начисление зарплаты сотрудникам:**
   - Начисление зарплаты:  
     *Дебет 44 (Расходы на продажу) / 20 (Основное производство) — Кредит 70 (Расчёты с персоналом)*
   - Удержание НДФЛ:  
     *Дебет 70 — Кредит 68 (НДФЛ)*
   - Начисление страховых взносов:  
     *Дебет 44 / 20 — Кредит 69 (Расчёты по соцстрахованию)*

3. **Определение финансового результата:**
   - Закрытие коммерческих расходов: *Дт 90.2 — Кт 44*
   - Определение прибыли: *Дт 90.9 — Кт 99 (Прибыли и убытки)*

4. **Уплата налогов и выплата зарплаты:**
   - Выплата зарплаты: *Дт 70 — Кт 51*
   - Уплата НДФЛ и взносов: *Дт 68 / 69 — Кт 51*
   - Начисление и уплата налога на прибыль:  
     *Дт 99 — Кт 68*, затем *Дт 68 — Кт 51*

**Итог:**  
Активы увеличились на сумму продажи, уменьшились на выплаты. Обязательства возникали при начислениях и исчезали при выплатах. Капитал увеличился на чистую прибыль.

---

### **Q2:** Можно ли этот процесс представить в виде дерева выражений и правил ЕСЛИ-ТО?

**A2:**  
Да, процесс идеально ложится на логику дерева выражений. Пример правил:

- **Уровень 1: Продажа и выручка**
  - *ЕСЛИ клиент оплатил товар (предоплата)* → *Дт 51, Кт 62*
  - *ЕСЛИ товар отгружен* → *Дт 62, Кт 90.1* (выручка), *Дт 90.2, Кт 41* (себестоимость), *Дт 90.3, Кт 68* (НДС)

- **Уровень 2: Зарплата**
  - *ЕСЛИ прошёл месяц* → *Дт 44, Кт 70* (начисление), *Дт 44, Кт 69* (взносы)
  - *ЕСЛИ день выплаты* → *Дт 70, Кт 68* (НДФЛ), *Дт 70, Кт 51* (выплата)

- **Уровень 3: Финансовый результат**
  - *ЕСЛИ конец месяца* → закрытие счетов 90 и 44
  - *ЕСЛИ доходы > расходов* → *Кт 99* (прибыль)

- **Уровень 4: Итоговые налоги**
  - *ЕСЛИ зафиксирована прибыль* → *Дт 99, Кт 68* (налог на прибыль)
  - *ЕСЛИ срок платежа* → *Дт 68, Кт 51*

---

### **Q3:** Насколько глубоким может быть такое дерево?

**A3:**  
Дерево может быть очень глубоким в зависимости от сложности бизнеса:

- **Базовый уровень:** 4–5 уровней (малый бизнес)
- **Профессиональный уровень:** 10–15 уровней (крупные компании)

**Направления углубления:**
1. Аналитика (субсчета: склад, категория, артикул, партия)
2. Налоговые разницы (ПБУ 18/02 → ОНО/ОНА)
3. Косвенные расходы (аллокация затрат)
4. Консолидация (элиминация внутри холдинга)

**Пример глубокого правила:**  
*ЕСЛИ товар продан в рассрочку в валюте, и курс упал* → отразить курсовую разницу, создать резерв по долгам.

---

### **Q4:** В какой момент времени происходят операции проводки по счетам, когда происходит переход и что является триггером?

**A4:**  
Принцип начисления: проводки отражаются при наступлении события, а не при движении денег. Триггер — **первичный документ**.

1. **Сделка:**  
   - *Триггер:* Подписание УПД (отгрузка)  
   - *Проводки:* *Дт 62 — Кт 90.1*; *Дт 90.2 — Кт 41*; *Дт 90.3 — Кт 68*

2. **Зарплата:**  
   - *Триггер:* Последний день месяца (табель)  
   - *Проводки:* *Дт 44 — Кт 70*

3. **Налоги:**  
   - *Триггер:* Момент отгрузки (НДС), 28-е число (срок уплаты)  
   - *Проводки:* *Дт 90.3 — Кт 68*; *Дт 68 — Кт 51*

**Переход:**  
- *Переход права собственности:* момент передачи товара
- *Переход периода:* первое число нового месяца (закрытие счетов)

---

### **Q5:** Проходят ли деньги через все дочерние субсчета по очереди, или сразу оказываются на определённом из них, в зависимости от условий?

**A5:**  
Деньги сразу попадают на конечный субсчет, но логически агрегируются на всех уровнях выше.

- **Прямое попадание:** Проводка делается на конкретный субсчет (например, 51.01 — Альфа-банк).
- **Условия выбора:** Система проверяет правила (валюта, тип операции) для выбора субсчета.
- **Транзитные счета:** В некоторых случаях деньги действительно проходят последовательно (например, эквайринг: *Дт 57 — Кт 62* → *Дт 51 — Кт 57*).

---

### **Q6:** Может ли быть две параллельные проводки на один триггер?

**A6:**  
Да, это стандартная практика. Один триггер порождает пакет проводок, которые выполняются атомарно.

**Примеры:**
1. *Отгрузка товара:*  
   - *Дт 62 — Кт 90.1* (выручка)  
   - *Дт 90.2 — Кт 41* (списание)  
   - *Дт 90.3 — Кт 68* (НДС)

2. *Выплата зарплаты:*  
   - *Дт 70 — Кт 51* (выплата)  
   - *Дт 70 — Кт 68* (НДФЛ)

**Важно:** В каждой проводке сохраняется принцип двойной записи.

---

### **Q7:** Как происходит итоговый подсчёт? Приведите пример.

**A7:**  
**Закрытие месяца** — автоматический процесс переноса остатков на счёт прибыли.

**Пример цифр:**
- Выручка (90.1): 1 200 000 ₽
- Себестоимость (90.2): 500 000 ₽
- НДС (90.3): 200 000 ₽
- Расходы (44): 300 000 ₽

**Расчёт:**
1. *Закрытие счетов:*  
   - *Кт 90.9 ← 1 200 000*  
   - *Дт 90.9 ← 500 000 + 200 000 + 300 000*
2. *Прибыль до налогов:*  
   *1 200 000 − 1 000 000 = 200 000 ₽*
3. *Налог на прибыль (20%):*  
   *200 000 × 20% = 40 000 ₽*  
   Проводка: *Дт 99 — Кт 68*
4. *Чистая прибыль:*  
   *200 000 − 40 000 = 160 000 ₽*  
   Переносится на счёт 84.

**Баланс:**  
*Актив (деньги) = Пассив (налоги + прибыль + капитал)*

---

### **Q8:** Получается, счета и условия, по которым происходит логика обработки, неразрывно связаны?

**A8:**  
Да, связь неразрывна:

1. **Счёт как тип данных:**  
   - Активный счёт (например, 51) — только ≥ 0
   - Пассивный счёт (например, 84) — зеркальная логика

2. **Условия определяют адрес проводки:**  
   Пример: *ЕСЛИ валюта = USD → использовать 62.21, ИНАЧЕ 62.01*

3. **Счёт как носитель алгоритма:**  
   Например, счёт 10 (материалы) при списании запускает метод FIFO.

**Аналогия:**  
Счета = узлы схемы, проводки = провода, логика = реле. Изменить одно без другого нельзя.
